# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

**–î–∞—Ç–∞:** 2025-01-02  
**–°—Ç–∞—Ç—É—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Zod)
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `zod`
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `lib/validation-schemas.ts` —Å —Å—Ö–µ–º–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
  - `profileCreateSchema` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
  - `profileUpdateSchema` - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
  - `transactionCreateSchema` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  - `portfolioAssetSchema` - –¥–ª—è –∞–∫—Ç–∏–≤–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è
  - `addressParamSchema` - –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–æ–≤
  - `emailQuerySchema` - –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã API endpoints —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:
  - `POST /api/profile` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
  - `PUT /api/profile` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
  - `GET /api/profile/[address]` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
  - `GET /api/profile/[address]/transactions` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
  - `POST /api/profile/[address]/transactions` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - `GET /api/profile/[address]/portfolio` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
  - `POST /api/profile/[address]/portfolio` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∞–∫—Ç–∏–≤–∞

### 2. –ó–∞–º–µ–Ω–µ–Ω console.log –Ω–∞ logger
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ API routes:
  - `app/api/profile/route.ts`
  - `app/api/profile/[address]/route.ts`
  - `app/api/profile/[address]/transactions/route.ts`
  - `app/api/stats/route.ts`
  - `app/api/stripe/webhook/route.ts`
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π logger
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π

### 3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª—å —á–µ—Ä–µ–∑ API
- ‚úÖ –°–æ–∑–¥–∞–Ω API endpoint `POST /api/profile/[address]/portfolio`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `addAssetToPortfolioInDB` –≤ `db-profile-utils.ts`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `BuyTokensSection.tsx`:
  - –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ API –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ —á–µ—Ä–µ–∑ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É
  - –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ API –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ —á–µ—Ä–µ–∑ Stripe
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Stripe webhook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª—å

### 4. –û–±–Ω–æ–≤–ª–µ–Ω Stripe webhook –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- ‚úÖ Webhook —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ë–î –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
- ‚úÖ Webhook –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ –ø–æ—Ä—Ç—Ñ–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –æ –Ω–∏—Ö
- ‚úÖ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ logger

### 5. –£–±—Ä–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ localStorage –¥–ª—è KYC banner
- ‚úÖ `DashboardSection.tsx` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `sessionStorage` –≤–º–µ—Å—Ç–æ `localStorage`
- ‚úÖ –î–∞–Ω–Ω—ã–µ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±–∞–Ω–Ω–µ—Ä–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 6. –°–æ–∑–¥–∞–Ω—ã API-–≤–µ—Ä—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `lib/api-profile-utils.ts` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
  - `getUserProfileFromAPI` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —á–µ—Ä–µ–∑ API
  - `saveUserProfileToAPI` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —á–µ—Ä–µ–∑ API
  - `createProfileViaAPI` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —á–µ—Ä–µ–∑ API
  - `addTransactionViaAPI` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ API
  - `addToPortfolioViaAPI` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∞ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª—å —á–µ—Ä–µ–∑ API
  - `getUserTransactionsFromAPI` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ API
  - `getPortfolioFromAPI` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è —á–µ—Ä–µ–∑ API
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –≤ `profile-utils.ts` –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `@deprecated`

## üìã –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏

### 1. –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å localStorage –Ω–∞ API
- ‚è≠Ô∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤—Å–µ –µ—â–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `profile-utils.ts`
- ‚è≠Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–º–µ–Ω—è—Ç—å –Ω–∞ —Ö—É–∫–∏ `useProfile` –∏ `useProfileMutation`

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∞–¥—Ä–µ—Å–∞
- ‚è≠Ô∏è –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–ª–∞–¥–µ–µ—Ç –∞–¥—Ä–µ—Å–æ–º
- ‚è≠Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (message signing)
- ‚è≠Ô∏è –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É `ethers.js` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–µ–π

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ rate limiting
- ‚è≠Ô∏è API endpoints –Ω–µ –∏–º–µ—é—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- ‚è≠Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å rate limiting middleware

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚è≠Ô∏è –ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (JWT –∏–ª–∏ NextAuth)
- ‚è≠Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª—è production

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è
–í—Å–µ API endpoints —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç Zod –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ (–∞–¥—Ä–µ—Å–∞, email, referral codes)
- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π logger:
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (debug, info, warn, error)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫
- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

1. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**: –ó–∞–º–µ–Ω—è–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `profile-utils.ts` –Ω–∞ API-–≤–µ—Ä—Å–∏–∏ –∏–ª–∏ —Ö—É–∫–∏
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è Web3 –∞–¥—Ä–µ—Å–æ–≤
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤—å—Ç–µ unit-—Ç–µ—Å—Ç—ã –¥–ª—è API endpoints
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ (Sentry, LogRocket)

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ API endpoints –∑–∞—â–∏—â–µ–Ω—ã –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º
- ‚úÖ Stripe webhook –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!

