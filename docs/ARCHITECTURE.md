# Архитектура децентрализованной лотереи

## Обзор системы

Децентрализованная лотерея состоит из нескольких ключевых компонентов:

1. **Smart Contract** - основная логика на блокчейне
2. **Frontend** - пользовательский интерфейс
3. **VRF (Verifiable Random Function)** - безопасная генерация случайных чисел

## Компоненты Smart Contract

### Основные функции

#### 1. Управление лотереей
- `createLottery()` - создание новой лотереи
- `endLottery()` - завершение лотереи и выбор победителя
- `buyTicket()` - покупка билета

#### 2. Информационные функции
- `getPlayerTickets()` - получить билеты игрока
- `getPrizePool()` - получить размер призового фонда
- `getLotteryStatus()` - получить статус лотереи

### Безопасность

#### Критические моменты:

1. **Генерация случайных чисел**
   - ❌ НЕ использовать: `block.timestamp`, `block.difficulty`, `blockhash`
   - ✅ Использовать: Chainlink VRF (Verifiable Random Function)

2. **Управление средствами**
   - Использовать проверенные паттерны для передачи средств
   - ReentrancyGuard от OpenZeppelin
   - Проверка баланса перед выводом

3. **Доступ**
   - Модификаторы для ограничения доступа
   - Роли (owner, admin)

## Этапы разработки

### Этап 1: Базовая структура ✅
- [x] Создание структуры проекта
- [x] Базовый контракт с основной логикой
- [ ] Конфигурация Hardhat

### Этап 2: Интеграция VRF
- [ ] Интеграция Chainlink VRF
- [ ] Модификация логики выбора победителя
- [ ] Тестирование VRF

### Этап 3: Тестирование
- [ ] Unit тесты для всех функций
- [ ] Интеграционные тесты
- [ ] Тесты безопасности (reentrancy, overflow)

### Этап 4: Frontend
- [ ] Подключение Web3
- [ ] UI для покупки билетов
- [ ] Отображение статуса лотереи
- [ ] История транзакций

### Этап 5: Деплой и аудит
- [ ] Деплой на testnet
- [ ] Тестирование на testnet
- [ ] Аудит безопасности
- [ ] Деплой на mainnet

## Рекомендации

### Для production:

1. **Используйте Chainlink VRF v2**
   ```solidity
   import "@chainlink/contracts/src/v0.8/VRFConsumerBaseV2.sol";
   ```

2. **Добавьте таймауты**
   - Максимальная длительность лотереи
   - Возврат средств если лотерея не завершилась

3. **Множественные победители**
   - Поддержка нескольких призовых мест
   - Распределение призового фонда

4. **События (Events)**
   - Все важные действия должны эмитировать события
   - Для отслеживания и отладки

5. **Gas оптимизация**
   - Используйте `packed structs` где возможно
   - Оптимизируйте loops
   - Кэшируйте storage переменные

## Следующие шаги

1. Установить зависимости: `npm install`
2. Изучить текущий контракт в `contracts/Lottery.sol`
3. Интегрировать Chainlink VRF
4. Написать тесты
5. Создать frontend

