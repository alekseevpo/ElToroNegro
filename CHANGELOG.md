# Журнал разработки (Changelog)

**⚠️ ВАЖНО:** Этот журнал должен обновляться при каждом значимом изменении в проекте.

Все значимые изменения в проекте документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

---

## [Unreleased] - Текущая разработка

> **Последнее обновление:** При каждом коммите/изменении  
> **Статус:** Активная разработка

### Добавлено
- **InvestmentPool.sol** - смарт-контракт для инвестиционного пула
- **tests/InvestmentPool.test.js** - полный набор тестов для InvestmentPool (32 теста)
  - Инвестиции от €10 эквивалента (минимум ~0.004 ETH)
  - Период инвестирования 7 дней
  - Процентная ставка за неделю (настраиваемая)
  - Комиссия платформы с процентов (настраиваемая, максимум 5%)
  - Функции вывода средств (по одной инвестиции или все сразу)
  - Статистика по инвестициям пользователей и пулу
  - Emergency pause механизм
  - Защита от повторного входа
- **scripts/deployInvestmentPool.js** - скрипт деплоя инвестиционного пула
- **docs/INVESTMENT_POOL.md** - документация по инвестиционному пулу
- **Frontend приложение** - Next.js 14 приложение для инвестиционной платформы
  - Главная страница с инвестиционными опциями
  - Страница "My Investments" для управления инвестициями
  - Страница лотереи с интеграцией Web3
  - Страница ставок на цену BTC
  - Интеграция MetaMask wallet через useWallet hook
  - Интеграция InvestmentPool контракта через useInvestmentPool hook
  - Компонент InvestmentOptionsWithContract с реальным взаимодействием со смарт-контрактом
  - Компонент MyInvestmentsSection для просмотра и вывода инвестиций
  - Утилиты для работы с контрактами (lib/contracts.ts)
  - Минималистичный дизайн в стиле Apple
  - Компоненты: Header, Footer, Hero, InvestmentOptions, Features, Stats, WalletButton
- **BitcoinPriceBet.sol** - контракт для ставок на цену биткоина
  - Интеграция Chainlink Price Feeds для получения цены BTC/USD
  - Логика ставок с указанием предполагаемой цены
  - Автоматическое определение победителей (ближайшие к реальной цене)
  - Распределение призов между победителями
  - Emergency pause механизм
  - Комиссия для owner (настраиваемая, максимум 10%)
- **scripts/deployBitcoinBet.js** - скрипт деплоя контракта ставок
- **docs/BITCOIN_PRICE_BET.md** - подробная документация по контракту ставок
- **CHANGELOG.md** - журнал разработки для отслеживания всех изменений
- **docs/CHANGELOG_GUIDE.md** - руководство по ведению журнала разработки
- **docs/DEV_NOTES.md** - шпаргалка для разработчика
- Документация по улучшениям для production (`docs/PRODUCTION_IMPROVEMENTS.md`)
- Раздел "Критические предупреждения" в README с детальными рекомендациями

### Изменено
- Улучшена структура CHANGELOG.md с разделом для текущей разработки
- Добавлены инструкции по ведению журнала разработки
- README.md обновлен с информацией о новых контрактах и ссылками на документацию
- README.md расширен разделом о ставках на цену BTC
- WalletButton компонент обновлен для использования useWallet hook
- Главная страница использует InvestmentOptionsWithContract с реальной интеграцией

### Планируется
- [ ] Расширенные тесты для LotteryV2
- [ ] Frontend приложение
- [ ] Интеграционные тесты с VRF mock
- [ ] Аудит безопасности контрактов

## [0.2.0] - 2024-XX-XX

### Добавлено
- **LotteryV2.sol** - улучшенная версия контракта для production
  - Emergency Pause механизм (OpenZeppelin Pausable)
  - Таймауты для лотереи и выбора победителя
  - Автоматический возврат средств через `refundMyTickets()`
  - Emergency refund функция для owner (`emergencyRefundAll()`)
  - Комиссия для owner (настраиваемая, максимум 10%)
  - Интеграция OpenZeppelin Ownable для улучшенного управления доступом
  - Улучшенный статус лотереи с информацией о таймаутах

### Изменено
- README.md обновлен с информацией о реализованных улучшениях
- Добавлены ссылки на документацию по улучшениям для production

### Технические детали
- Использование OpenZeppelin контрактов (Pausable, Ownable) версии 5.x
- Добавлены новые события: `FundsRefunded`, `EmergencyRefund`, `CommissionUpdated`
- Улучшена функция `getLotteryStatus()` с дополнительными полями

## [0.1.0] - 2024-XX-XX

### Добавлено
- **Базовая структура проекта**
  - Инициализация проекта с Hardhat
  - Настройка зависимостей (Chainlink, OpenZeppelin)
  - Конфигурация Hardhat для компиляции и тестирования

- **Lottery.sol** - базовый контракт лотереи
  - Интеграция Chainlink VRF v2 для безопасного выбора победителя
  - Защита от повторного входа (ReentrancyGuard)
  - Функции покупки билетов (`buyTicket()`)
  - Функция запроса выбора победителя (`requestWinnerSelection()`)
  - Callback функция для получения случайного числа (`fulfillRandomWords()`)
  - Функция создания новой лотереи (`createNewLottery()`)
  - View функции для получения информации о лотерее

- **Тесты**
  - Базовые unit-тесты (`tests/Lottery.test.js`)
  - 15 тестов покрывающих основную функциональность
  - Тесты для деплоя, покупки билетов, управления доступом

- **Скрипты деплоя**
  - `scripts/deploy.js` - скрипт для деплоя контракта
  - `scripts/addConsumer.js` - скрипт для добавления consumer в Chainlink subscription

- **Документация**
  - README.md с описанием проекта
  - `docs/ARCHITECTURE.md` - описание архитектуры системы
  - `docs/DEPLOYMENT.md` - руководство по деплою
  - `docs/NEXT_STEPS.md` - план дальнейшей разработки

### Технические детали
- Solidity версия: 0.8.20
- Chainlink VRF v2 интеграция
- OpenZeppelin Contracts версия 5.x
- Hardhat для разработки и тестирования
- Поддержка Sepolia testnet в конфигурации

### Известные ограничения (в базовой версии)
- Нет механизма таймаутов
- Нет emergency pause
- Нет комиссии для owner
- Нет механизма возврата средств

---

## История версий

### Версия 0.2.0 (Текущая)
- Production-ready версия с улучшениями безопасности
- Emergency pause, таймауты, комиссия

### Версия 0.1.0
- Базовая функциональность лотереи
- Интеграция Chainlink VRF v2
- Базовые тесты

---

## Типы изменений

- **Добавлено** - новые функции
- **Изменено** - изменения в существующей функциональности
- **Устарело** - функции, которые скоро будут удалены
- **Удалено** - удаленные функции
- **Исправлено** - исправления багов
- **Безопасность** - изменения, связанные с безопасностью

---

## Следующие шаги

Планируемые улучшения:
- [ ] Расширенные тесты для LotteryV2
- [ ] Frontend приложение
- [ ] Интеграционные тесты с VRF mock
- [ ] Аудит безопасности контрактов
- [ ] Возможность upgradeable контракта (через proxy)
- [ ] Мониторинг и уведомления для subscription

